#!/usr/bin/env bash
# Maintainer: Hunter Peavey < printf "srht@die.bots" | sed "s/die.bots/krathalan.net/g" >
# shellcheck disable=SC2034
# shellcheck disable=SC2154

# General package information
pkgname=pandoc-static
pkgver=2.10.1
pkgrel=1
pkgdesc="Krathalan's static pandoc (pandoc-bin style), built from source"
url="https://pandoc.org"
license=("GPL")
arch=("any")
conflicts=("pandoc" "pandoc-bin")

# Dependencies
depends=()
makedepends=("stack")

# Download information
source=("https://hackage.haskell.org/package/pandoc-${pkgver}/pandoc-${pkgver}.tar.gz")
sha256sums=('SKIP')

build() {
  cd "${srcdir}/pandoc-${pkgver}" || exit 1
  HOME="${PWD}" stack setup
  HOME="${PWD}" stack build --flag pandoc:embed_data_files
  HOME="${PWD}" stack install
}

package() {
  cd "${srcdir}/pandoc-${pkgver}" || exit 1

  install -D -m755 .local/bin/pandoc "${pkgdir}/usr/bin/pandoc"
  install -D -m644 man/pandoc.1 "${pkgdir}/usr/share/man/man1/pandoc.1"
}
