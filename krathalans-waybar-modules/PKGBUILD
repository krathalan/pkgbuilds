#!/usr/bin/env bash
# Maintainer: Hunter Peavey < printf "srht@die.bots" | sed "s/die.bots/krathalan.net/g" >
# shellcheck disable=SC2034
# shellcheck disable=SC2154

# General package information
pkgname=krathalans-waybar-modules
pkgver=2.0.2
pkgrel=1
pkgdesc="Krathalan's personal waybar modules"
url="https://git.sr.ht/~krathalan/waybar-modules"
license=("GPL3")
arch=("any")

# Dependencies
depends=()

# Download information
_packagesig="${url}/blob/master/signatures/${pkgver}.tar.gz.sig"
source=("${url}/archive/${pkgver}.tar.gz" "${_packagesig}")
validpgpkeys=("B46B326273E4A1D21AAA3F6F529AC10050BD24EF")
sha512sums=("ef4ef6da8477220fe094d1ccc3a25113501b640119be71052b827378d2970b88df4da96fd3ba50989397196038226871ccacdcd21c7e547a77047aaba676de8c" "e8a4719f724ff30ac1fae69b6c92786ad8e3fd3246ab58532a9b92535d8fe202bbe4d35fb632217228bdb6a45d9ab9cd0dd35090acbce5f9c734f615595a90ae")

# Package specific information
_MODULES=("battery" "vpn")

build() {
  for module in "${_MODULES[@]}"; do
    cd "${srcdir}/waybar-modules-${pkgver}/${module}" || exit
    make clean > /dev/null
    make release
  done
}

package() {
  for module in "${_MODULES[@]}"; do
    cd "${srcdir}/waybar-modules-${pkgver}/${module}" || exit
    install -D -m755 "wbm_${module}" "${pkgdir}/usr/bin/wbm_${module}"
  done

  cd "${srcdir}/waybar-modules-${pkgver}/apparmor-profiles" || exit

  for profile in ./*; do
    install -D -m644 "${profile}" "${pkgdir}/etc/apparmor.d/${profile}"
  done
}
