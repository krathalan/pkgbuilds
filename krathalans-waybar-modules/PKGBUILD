#!/usr/bin/env bash
# Maintainer: Hunter Peavey < printf "srht@die.bots" | sed "s/die.bots/krathalan.net/g" >
# shellcheck disable=SC2034
# shellcheck disable=SC2154

# General package information
pkgname=krathalans-waybar-modules
pkgver=2.0.1
pkgrel=1
pkgdesc="Krathalan's personal waybar modules"
url="https://git.sr.ht/~krathalan/waybar-modules"
license=("GPL3")
arch=("any")

# Dependencies
depends=()

# Download information
_packagesig="${url}/blob/master/signatures/${pkgver}.tar.gz.sig"
source=("${url}/archive/${pkgver}.tar.gz" "${_packagesig}")
validpgpkeys=("B46B326273E4A1D21AAA3F6F529AC10050BD24EF")
sha512sums=("381ceadd1def3dece5348ee91217cc6d467b44765ad1a5f4d57edfab2866f42afc74969226c7376aa4c9825fa9533f5c6aab36ed3a49803866fdfbda003c37ac" "4ac91f914c1e19654c27fbdc9ac781b4f21c58c4ff8e61e196f9e67b8c10dae737ec4b7a6256a2ccae59ddefd91d5bc28e741a35ff1ded17bd4ebb920a414b11")

# Package specific information
_MODULES=("battery" "vpn")

build() {
  for module in "${_MODULES[@]}"; do
    cd "${srcdir}/waybar-modules-${pkgver}/${module}" || exit
    make clean > /dev/null
    make release
  done
}

package() {
  for module in "${_MODULES[@]}"; do
    cd "${srcdir}/waybar-modules-${pkgver}/${module}" || exit
    install -D -m755 "wbm_${module}" "${pkgdir}/usr/bin/wbm_${module}"
  done

  cd "${srcdir}/waybar-modules-${pkgver}/apparmor-profiles" || exit

  for profile in ./*; do
    install -D -m644 "${profile}" "${pkgdir}/etc/apparmor.d/${profile}"
  done
}
